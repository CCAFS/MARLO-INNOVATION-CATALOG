---
import getSharingLink from '~/utils/share-link/getSharingLink';
import BasicButton from '../button/BasicButton/BasicButton.component.astro';

interface Props {
  url?: string;
  title?: string;
  isJustIcon?: boolean;
  className?: string;
}

const { url, title, isJustIcon, className } = Astro.props;

// Get the current page URL if not provided
const shareUrl = url || Astro.url.href;
const shareTitle = title || 'Check out this innovation';
// Encode URL and title for sharing
const encodedUrl = encodeURIComponent(shareUrl);
const encodedTitle = encodeURIComponent(shareTitle);

// Social media share URLs
/* const linkedInUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodedUrl}`;
const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`;
const twitterUrl = `https://twitter.com/intent/tweet?url=${encodedUrl}&text=${encodedTitle}`; */

const linkedInUrl = getSharingLink({
  url: shareUrl,
  network: 'linkedin'
});

const facebookUrl = getSharingLink({
  url: shareUrl,
  network: 'facebook'
});

const twitterUrl = getSharingLink({
  url: shareUrl,
  title: shareTitle,
  network: 'twitter',
  hashtags: 'Innovation,Research,AICCRA'
});
---

<div class="social-share-container group relative overflow-visible">
  <BasicButton
    {...isJustIcon ? {} : { text: 'Share to social network' }}
    hasIcon
    icon="pi pi-share-alt"
    classList={`w-full justify-center border-accent-300 !text-accent-300 mb-2 hover:!bg-accent-300 hover:!text-white cursor-pointer ${className}`}
  />
  <!-- Dropdown wrapper with padding to bridge the gap -->
  <div class={`dropdown-wrapper hidden group-hover:block absolute top-full w-full pt-1 z-10`}>
    <div
      class={`social-share-dropdown bg-white border border-border-light rounded-lg shadow-lg ${isJustIcon ? 'w-max absolute right-0' : 'overflow-hidden w-full'}`}>
      <!-- LinkedIn -->
      <a
        href={linkedInUrl}
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center gap-3 px-4 py-3 text-xs text-text-800 hover:bg-gray-50 transition-colors duration-200">
        <i class="pi pi-linkedin text-[#0A66C2] text-base"></i>
        <span>Share on LinkedIn</span>
      </a>

      <!-- Facebook -->
      <a
        href={facebookUrl}
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center gap-3 px-4 py-3 text-xs text-text-800 hover:bg-gray-50 transition-colors duration-200 border-t border-border-light">
        <i class="pi pi-facebook text-[#1877F2] text-base"></i>
        <span>Share on Facebook</span>
      </a>

      <!-- Twitter/X -->
      <a
        href={twitterUrl}
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center gap-3 px-4 py-3 text-xs text-text-800 hover:bg-gray-50 transition-colors duration-200 border-t border-border-light">
        <i class="pi pi-twitter text-[#000000] text-base"></i>
        <span>Share on X (Twitter)</span>
      </a>

      <!-- Copy Link -->
      <button
        type="button"
        class="copy-link-btn w-full flex items-center gap-3 px-4 py-3 text-xs text-text-800 hover:bg-gray-50 transition-colors duration-200 border-t border-border-light text-left"
        data-url={shareUrl}>
        <i class="pi pi-link text-accent-300 text-base"></i>
        <span class="copy-link-text">Copy hyperlink</span>
      </button>
    </div>
  </div>
</div>

<script>
  // Handle copy link functionality
  document.addEventListener('DOMContentLoaded', () => {
    const copyButtons = document.querySelectorAll('.copy-link-btn');

    copyButtons.forEach(button => {
      button.addEventListener('click', async e => {
        e.preventDefault();
        const url = button.getAttribute('data-url');
        const textSpan = button.querySelector('.copy-link-text');

        if (url && textSpan) {
          try {
            await navigator.clipboard.writeText(url);
            const originalText = textSpan.textContent;
            textSpan.textContent = 'Copied!';

            setTimeout(() => {
              textSpan.textContent = originalText;
            }, 2000);
          } catch (err) {
            console.error('Failed to copy:', err);
            textSpan.textContent = 'Failed to copy';
            setTimeout(() => {
              textSpan.textContent = 'Copy hyperlink';
            }, 2000);
          }
        }
      });
    });
  });
</script>

<style>
  .social-share-container {
    position: relative;
  }

  .dropdown-wrapper {
    min-width: 100%;
  }

  /* Ensure dropdown stays visible on hover - the wrapper includes padding to bridge the gap */
  .social-share-container:hover .dropdown-wrapper,
  .dropdown-wrapper:hover {
    display: block;
  }
</style>
